if(THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var r,t,i,n,o,a,s,l,c,p,d,E,h,f,u,m,v,y,x,R=this,w=new THREE.Projector,T=void 0!==e.canvas?e.canvas:document.createElement("canvas"),g=T.width,S=T.height,H=Math.floor(g/2),M=Math.floor(S/2),C=0,b=0,z=g,V=S,j=1,O=T.getContext("2d",{alpha:!0===e.alpha}),L=new THREE.Color(16711680),A=1,P=1,B=0,N=null,W=null,k=null,F=null,I=null,U=[],D=new THREE.Color,G=new THREE.Color,X=new THREE.Color,Y=new THREE.Color,q={},$=new THREE.Box2,_=new THREE.Box2,J=new THREE.Box2,K=new THREE.Color,Q=new THREE.Color,Z=new THREE.Color,ee=new THREE.Vector3,re=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Matrix3;function ne(e,r,t){Ee(t.opacity),he(t.blending);var i=r.scale.x*H,n=r.scale.y*M,o=Math.sqrt(i*i+n*n);if(J.min.set(e.x-o,e.y-o),J.max.set(e.x+o,e.y+o),t.isSpriteMaterial){var a=t.map;if(null!==a){var s=q[a.id];if(void 0!==s&&s.version===a.version||(s=ce(a),q[a.id]=s),void 0!==s.canvas){ye(s.canvas);var l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,d=l.width*a.repeat.x,E=l.height*a.repeat.y,h=i/d,f=n/E;O.save(),O.translate(e.x,e.y),0!==t.rotation&&O.rotate(t.rotation),O.translate(-i/2,-n/2),O.scale(h,f),O.translate(-c,-p),O.fillRect(c,p,d,E),O.restore()}}else ye(t.color.getStyle()),O.save(),O.translate(e.x,e.y),0!==t.rotation&&O.rotate(t.rotation),O.scale(i,-n),O.fillRect(-.5,-.5,1,1),O.restore()}else t.isSpriteCanvasMaterial?(ve(t.color.getStyle()),ye(t.color.getStyle()),O.save(),O.translate(e.x,e.y),0!==t.rotation&&O.rotate(t.rotation),O.scale(i,n),t.program(O),O.restore()):t.isPointsMaterial&&(ye(t.color.getStyle()),O.save(),O.translate(e.x,e.y),0!==t.rotation&&O.rotate(t.rotation),O.scale(i*t.size,-n*t.size),O.fillRect(-.5,-.5,1,1),O.restore())}function oe(e,r,t,i){if(Ee(i.opacity),he(i.blending),O.beginPath(),O.moveTo(e.positionScreen.x,e.positionScreen.y),O.lineTo(r.positionScreen.x,r.positionScreen.y),i.isLineBasicMaterial){if(fe(i.linewidth),ue(i.linecap),me(i.linejoin),i.vertexColors!==THREE.VertexColors)ve(i.color.getStyle());else{var n=t.vertexColors[0].getStyle(),o=t.vertexColors[1].getStyle();if(n===o)ve(n);else{try{var a=O.createLinearGradient(e.positionScreen.x,e.positionScreen.y,r.positionScreen.x,r.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}ve(a)}}O.stroke(),J.expandByScalar(2*i.linewidth)}else i.isLineDashedMaterial&&(fe(i.linewidth),ue(i.linecap),me(i.linejoin),ve(i.color.getStyle()),xe([i.dashSize,i.gapSize]),O.stroke(),J.expandByScalar(2*i.linewidth),xe([]))}function ae(e,r,t,n,o,a,w,T){var g,S,H,M,C,b;if(R.info.render.vertices+=3,R.info.render.faces++,Ee(T.opacity),he(T.blending),s=e.positionScreen.x,l=e.positionScreen.y,c=r.positionScreen.x,p=r.positionScreen.y,d=t.positionScreen.x,E=t.positionScreen.y,g=s,S=l,H=c,M=p,C=d,b=E,O.beginPath(),O.moveTo(g,S),O.lineTo(H,M),O.lineTo(C,b),O.closePath(),(T.isMeshLambertMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial)&&null===T.map)G.copy(T.color),X.copy(T.emissive),T.vertexColors===THREE.FaceColors&&G.multiply(w.color),D.copy(K),re.copy(e.positionWorld).add(r.positionWorld).add(t.positionWorld).divideScalar(3),function(e,r,t){for(var n=0,o=i.length;n<o;n++){var a=i[n];if(Y.copy(a.color),a.isDirectionalLight){var s=ee.setFromMatrixPosition(a.matrixWorld).normalize();if((l=r.dot(s))<=0)continue;l*=a.intensity,t.add(Y.multiplyScalar(l))}else if(a.isPointLight){var l;if(s=ee.setFromMatrixPosition(a.matrixWorld),(l=r.dot(ee.subVectors(s,e).normalize()))<=0)continue;if(0==(l*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1)))continue;l*=a.intensity,t.add(Y.multiplyScalar(l))}}}(re,w.normalModel,D),D.multiply(G).add(X),!0===T.wireframe?se(D,T.wireframeLinewidth,T.wireframeLinecap,T.wireframeLinejoin):le(D);else if(T.isMeshBasicMaterial||T.isMeshLambertMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial){if(null!==T.map)T.map.mapping===THREE.UVMapping&&(h=w.uvs,pe(s,l,c,p,d,E,h[n].x,h[n].y,h[o].x,h[o].y,h[a].x,h[a].y,T.map));else null!==T.envMap?T.envMap.mapping===THREE.SphericalReflectionMapping&&(te.copy(w.vertexNormalsModel[n]).applyMatrix3(ie),f=.5*te.x+.5,u=.5*te.y+.5,te.copy(w.vertexNormalsModel[o]).applyMatrix3(ie),m=.5*te.x+.5,v=.5*te.y+.5,te.copy(w.vertexNormalsModel[a]).applyMatrix3(ie),y=.5*te.x+.5,x=.5*te.y+.5,pe(s,l,c,p,d,E,f,u,m,v,y,x,T.envMap)):(D.copy(T.color),T.vertexColors===THREE.FaceColors&&D.multiply(w.color),!0===T.wireframe?se(D,T.wireframeLinewidth,T.wireframeLinecap,T.wireframeLinejoin):le(D))}else T.isMeshNormalMaterial?(te.copy(w.normalModel).applyMatrix3(ie),D.setRGB(te.x,te.y,te.z).multiplyScalar(.5).addScalar(.5),!0===T.wireframe?se(D,T.wireframeLinewidth,T.wireframeLinecap,T.wireframeLinejoin):le(D)):(D.setRGB(1,1,1),!0===T.wireframe?se(D,T.wireframeLinewidth,T.wireframeLinecap,T.wireframeLinejoin):le(D))}function se(e,r,t,i){fe(r),ue(t),me(i),ve(e.getStyle()),O.stroke(),J.expandByScalar(2*r)}function le(e){ye(e.getStyle()),O.fill()}function ce(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var r=e.image;if(!1===r.complete)return{canvas:void 0,version:0};var t=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=r.width*(n?2:1),a.height=r.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,r.height),s.drawImage(r,0,0),!0===n&&(s.setTransform(-1,0,0,-1,r.width,r.height),s.drawImage(r,-r.width,0)),!0===o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(r,0,r.height)),!0===n&&!0===o&&(s.setTransform(-1,0,0,1,r.width,0),s.drawImage(r,-r.width,r.height));var l="no-repeat";!0===t&&!0===i?l="repeat":!0===t?l="repeat-x":!0===i&&(l="repeat-y");var c=O.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function pe(e,r,t,i,n,o,a,s,l,c,p,d,E){var h=q[E.id];if(void 0!==h&&h.version===E.version||(h=ce(E),q[E.id]=h),void 0===h.canvas)return ye("rgba( 0, 0, 0, 1)"),void O.fill();ye(h.canvas);var f,u,m,v,y,x,R,w,T=E.offset.x/E.repeat.x,g=E.offset.y/E.repeat.y,S=E.image.width*E.repeat.x,H=E.image.height*E.repeat.y;l=(l+T)*S,c=(c+g)*H,p=(p+T)*S,d=(d+g)*H,t-=e,i-=r,n-=e,o-=r,0!==(R=(l-=a=(a+T)*S)*(d-=s=(s+g)*H)-(p-=a)*(c-=s))&&(y=e-(f=(d*t-c*n)*(w=1/R))*a-(m=(l*n-p*t)*w)*s,x=r-(u=(d*i-c*o)*w)*a-(v=(l*o-p*i)*w)*s,O.save(),O.transform(f,u,m,v,y,x),O.fill(),O.restore())}function de(e,r,t){var i,n=r.x-e.x,o=r.y-e.y,a=n*n+o*o;0!==a&&(n*=i=t/Math.sqrt(a),o*=i,r.x+=n,r.y+=o,e.x-=n,e.y-=o)}function Ee(e){P!==e&&(O.globalAlpha=e,P=e)}function he(e){B!==e&&(e===THREE.NormalBlending?O.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?O.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?O.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(O.globalCompositeOperation="multiply"),B=e)}function fe(e){k!==e&&(O.lineWidth=e,k=e)}function ue(e){F!==e&&(O.lineCap=e,F=e)}function me(e){I!==e&&(O.lineJoin=e,I=e)}function ve(e){N!==e&&(O.strokeStyle=e,N=e)}function ye(e){W!==e&&(O.fillStyle=e,W=e)}function xe(e){U.length!==e.length&&(O.setLineDash(e),U=e)}void 0===O.setLineDash&&(O.setLineDash=function(){}),this.domElement=T,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(e){void 0!==e&&(j=e)},this.setSize=function(e,r,t){g=e*j,S=r*j,T.width=g,T.height=S,H=Math.floor(g/2),M=Math.floor(S/2),!1!==t&&(T.style.width=e+"px",T.style.height=r+"px"),$.min.set(-H,-M),$.max.set(H,M),_.min.set(-H,-M),_.max.set(H,M),P=1,B=0,N=null,W=null,k=null,F=null,I=null,this.setViewport(0,0,e,r)},this.setViewport=function(e,r,t,i){C=e*j,b=r*j,z=t*j,V=i*j},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,r){L.set(e),A=void 0!==r?r:1,_.min.set(-H,-M),_.max.set(H,M)},this.setClearColorHex=function(e,r){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,r)},this.getClearColor=function(){return L},this.getClearAlpha=function(){return A},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===_.isEmpty()&&(_.intersect($),_.expandByScalar(2),_.min.x=_.min.x+H,_.min.y=-_.min.y+M,_.max.x=_.max.x+H,_.max.y=-_.max.y+M,A<1&&O.clearRect(0|_.min.x,0|_.max.y,_.max.x-_.min.x|0,_.min.y-_.max.y|0),A>0&&(he(THREE.NormalBlending),Ee(1),ye("rgba("+Math.floor(255*L.r)+","+Math.floor(255*L.g)+","+Math.floor(255*L.b)+","+A+")"),O.fillRect(0|_.min.x,0|_.max.y,_.max.x-_.min.x|0,_.min.y-_.max.y|0)),_.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,s){if(void 0!==s.isCamera){var l=e.background;l&&l.isColor?(ye("rgb(0,0,0)"),O.fillRect(0,0,g,S)):!0===this.autoClear&&this.clear(),R.info.render.vertices=0,R.info.render.faces=0,O.setTransform(z/g,0,0,-V/S,C,S-b),O.translate(H,M),r=w.projectScene(e,s,this.sortObjects,this.sortElements),t=r.elements,i=r.lights,ie.getNormalMatrix(s.matrixWorldInverse),function(){K.setRGB(0,0,0),Q.setRGB(0,0,0),Z.setRGB(0,0,0);for(var e=0,r=i.length;e<r;e++){var t=i[e],n=t.color;t.isAmbientLight?K.add(n):t.isDirectionalLight?Q.add(n):t.isPointLight&&Z.add(n)}}();for(var c=0,p=t.length;c<p;c++){var d=t[c],E=d.material;if(void 0!==E&&0!==E.opacity){if(J.makeEmpty(),d instanceof THREE.RenderableSprite)(n=d).x*=H,n.y*=M,ne(n,d,E);else if(d instanceof THREE.RenderableLine)n=d.v1,o=d.v2,n.positionScreen.x*=H,n.positionScreen.y*=M,o.positionScreen.x*=H,o.positionScreen.y*=M,J.setFromPoints([n.positionScreen,o.positionScreen]),!0===$.intersectsBox(J)&&oe(n,o,d,E);else if(d instanceof THREE.RenderableFace){if(n=d.v1,o=d.v2,a=d.v3,n.positionScreen.z<-1||n.positionScreen.z>1)continue;if(o.positionScreen.z<-1||o.positionScreen.z>1)continue;if(a.positionScreen.z<-1||a.positionScreen.z>1)continue;n.positionScreen.x*=H,n.positionScreen.y*=M,o.positionScreen.x*=H,o.positionScreen.y*=M,a.positionScreen.x*=H,a.positionScreen.y*=M,E.overdraw>0&&(de(n.positionScreen,o.positionScreen,E.overdraw),de(o.positionScreen,a.positionScreen,E.overdraw),de(a.positionScreen,n.positionScreen,E.overdraw)),J.setFromPoints([n.positionScreen,o.positionScreen,a.positionScreen]),!0===$.intersectsBox(J)&&ae(n,o,a,0,1,2,d,E)}_.union(J)}}O.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var e,r,t,i,n,o,a,s,l,c,p,d=[],E=0,h=[],f=0,u=[],m=0,v=[],y=0,x=[],R=0,w={objects:[],lights:[],elements:[]},T=new THREE.Vector3,g=new THREE.Vector4,S=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),H=new THREE.Box3,M=new Array(3),C=new THREE.Matrix4,b=new THREE.Matrix4,z=new THREE.Matrix4,V=new THREE.Matrix3,j=new THREE.Frustum,O=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var A=new function(){var e=[],r=[],i=[],o=null,s=null,l=new THREE.Matrix3;function c(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(p),i.copy(t).applyMatrix4(b);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function d(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(M[0]=e.positionScreen,M[1]=r.positionScreen,M[2]=t.positionScreen,S.intersectsBox(H.setFromPoints(M)))}function E(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(t){s=(o=t).material,l.getNormalMatrix(o.matrixWorld),e.length=0,r.length=0,i.length=0},projectVertex:c,checkTriangleVisibility:d,checkBackfaceCulling:E,pushVertex:function(e,r,i){(t=W()).position.set(e,r,i),c(t)},pushNormal:function(r,t,i){e.push(r,t,i)},pushColor:function(e,t,i){r.push(e,t,i)},pushUv:function(e,r){i.push(e,r)},pushLine:function(e,t){var i=h[e],n=h[t];i.positionScreen.copy(i.position).applyMatrix4(z),n.positionScreen.copy(n.position).applyMatrix4(z),!0===U(i.positionScreen,n.positionScreen)&&(i.positionScreen.multiplyScalar(1/i.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),(a=F()).id=o.id,a.v1.copy(i),a.v2.copy(n),a.z=Math.max(i.positionScreen.z,n.positionScreen.z),a.renderOrder=o.renderOrder,a.material=o.material,o.material.vertexColors===THREE.VertexColors&&(a.vertexColors[0].fromArray(r,3*e),a.vertexColors[1].fromArray(r,3*t)),w.elements.push(a))},pushTriangle:function(r,t,a){var c=h[r],p=h[t],f=h[a];if(!1!==d(c,p,f)&&(s.side===THREE.DoubleSide||!0===E(c,p,f))){(n=k()).id=o.id,n.v1.copy(c),n.v2.copy(p),n.v3.copy(f),n.z=(c.positionScreen.z+p.positionScreen.z+f.positionScreen.z)/3,n.renderOrder=o.renderOrder,n.normalModel.fromArray(e,3*r),n.normalModel.applyMatrix3(l).normalize();for(var u=0;u<3;u++){var m=n.vertexNormalsModel[u];m.fromArray(e,3*arguments[u]),m.applyMatrix3(l).normalize(),n.uvs[u].fromArray(i,2*arguments[u])}n.vertexNormalsLength=3,n.material=o.material,w.elements.push(n)}}}};function P(e){if(!1!==e.visible){if(e instanceof THREE.Light)w.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===j.intersectsObject(e))return;B(e)}else if(e instanceof THREE.Sprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===j.intersectsSprite(e))return;B(e)}for(var r=e.children,t=0,i=r.length;t<i;t++)P(r[t])}}function B(t){e=function(){if(r===E){var e=new THREE.RenderableObject;return d.push(e),E++,r++,e}return d[r++]}(),e.id=t.id,e.object=t,T.setFromMatrixPosition(t.matrixWorld),T.applyMatrix4(b),e.z=T.z,e.renderOrder=t.renderOrder,w.objects.push(e)}function N(e,r,t){var i=1/e.w;e.z*=i,e.z>=-1&&e.z<=1&&((l=function(){if(c===R){var e=new THREE.RenderableSprite;return x.push(e),R++,c++,e}return x[c++]}()).id=r.id,l.x=e.x*i,l.y=e.y*i,l.z=e.z,l.renderOrder=r.renderOrder,l.object=r,l.rotation=r.rotation,l.scale.x=r.scale.x*Math.abs(l.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),l.scale.y=r.scale.y*Math.abs(l.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),l.material=r.material,w.elements.push(l))}function W(){if(i===f){var e=new THREE.RenderableVertex;return h.push(e),f++,i++,e}return h[i++]}function k(){if(o===m){var e=new THREE.RenderableFace;return u.push(e),m++,o++,e}return u[o++]}function F(){if(s===y){var e=new THREE.RenderableLine;return v.push(e),y++,s++,e}return v[s++]}function I(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function U(e,r){var t=0,i=1,n=e.z+e.w,o=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?t=Math.max(t,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?t=Math.max(t,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<t)&&(e.lerp(r,t),r.lerp(e,1-i),!0))}this.projectScene=function(e,t,l,d){o=0,s=0,c=0,w.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),C.copy(t.matrixWorldInverse),b.multiplyMatrices(t.projectionMatrix,C),j.setFromMatrix(b),r=0,w.objects.length=0,w.lights.length=0,P(e),!0===l&&w.objects.sort(I);for(var E=w.objects,f=0,u=E.length;f<u;f++){var m=E[f].object,v=m.geometry;if(A.setObject(m),p=m.matrixWorld,i=0,m instanceof THREE.Mesh){if(v instanceof THREE.BufferGeometry){var y=v.attributes,x=v.groups;if(void 0===y.position)continue;for(var R=0,S=(we=y.position.array).length;R<S;R+=3)A.pushVertex(we[R],we[R+1],we[R+2]);if(void 0!==y.normal){var H=y.normal.array;for(R=0,S=H.length;R<S;R+=3)A.pushNormal(H[R],H[R+1],H[R+2])}if(void 0!==y.uv){var M=y.uv.array;for(R=0,S=M.length;R<S;R+=2)A.pushUv(M[R],M[R+1])}if(null!==v.index){var B=v.index.array;if(x.length>0)for(var D=0;D<x.length;D++){var G=x[D];for(R=G.start,S=G.start+G.count;R<S;R+=3)A.pushTriangle(B[R],B[R+1],B[R+2])}else for(R=0,S=B.length;R<S;R+=3)A.pushTriangle(B[R],B[R+1],B[R+2])}else for(R=0,S=we.length/3;R<S;R+=3)A.pushTriangle(R,R+1,R+2)}else if(v instanceof THREE.Geometry){var X=v.vertices,Y=v.faces,q=v.faceVertexUvs[0];V.getNormalMatrix(p);for(var $=m.material,_=Array.isArray($),J=0,K=X.length;J<K;J++){var Q=X[J];if(T.copy(Q),!0===$.morphTargets)for(var Z=v.morphTargets,ee=m.morphTargetInfluences,re=0,te=Z.length;re<te;re++){var ie=ee[re];if(0!==ie){var ne=Z[re].vertices[J];T.x+=(ne.x-Q.x)*ie,T.y+=(ne.y-Q.y)*ie,T.z+=(ne.z-Q.z)*ie}}A.pushVertex(T.x,T.y,T.z)}for(var oe=0,ae=Y.length;oe<ae;oe++){var se=Y[oe];if(void 0!==($=!0===_?m.material[se.materialIndex]:m.material)){var le=$.side,ce=h[se.a],pe=h[se.b],de=h[se.c];if(!1!==A.checkTriangleVisibility(ce,pe,de)){var Ee=A.checkBackfaceCulling(ce,pe,de);if(le!==THREE.DoubleSide){if(le===THREE.FrontSide&&!1===Ee)continue;if(le===THREE.BackSide&&!0===Ee)continue}(n=k()).id=m.id,n.v1.copy(ce),n.v2.copy(pe),n.v3.copy(de),n.normalModel.copy(se.normal),!1!==Ee||le!==THREE.BackSide&&le!==THREE.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(V).normalize();for(var he=se.vertexNormals,fe=0,ue=Math.min(he.length,3);fe<ue;fe++){var me=n.vertexNormalsModel[fe];me.copy(he[fe]),!1!==Ee||le!==THREE.BackSide&&le!==THREE.DoubleSide||me.negate(),me.applyMatrix3(V).normalize()}n.vertexNormalsLength=he.length;var ve=q[oe];if(void 0!==ve)for(var ye=0;ye<3;ye++)n.uvs[ye].copy(ve[ye]);n.color=se.color,n.material=$,n.z=(ce.positionScreen.z+pe.positionScreen.z+de.positionScreen.z)/3,n.renderOrder=m.renderOrder,w.elements.push(n)}}}}}else if(m instanceof THREE.Line){if(z.multiplyMatrices(b,p),v instanceof THREE.BufferGeometry){if(void 0!==(y=v.attributes).position){for(R=0,S=(we=y.position.array).length;R<S;R+=3)A.pushVertex(we[R],we[R+1],we[R+2]);if(void 0!==y.color){var xe=y.color.array;for(R=0,S=xe.length;R<S;R+=3)A.pushColor(xe[R],xe[R+1],xe[R+2])}if(null!==v.index)for(R=0,S=(B=v.index.array).length;R<S;R+=2)A.pushLine(B[R],B[R+1]);else{var Re=m instanceof THREE.LineSegments?2:1;for(R=0,S=we.length/3-1;R<S;R+=Re)A.pushLine(R,R+1)}}}else if(v instanceof THREE.Geometry){if(0===(X=m.geometry.vertices).length)continue;(ce=W()).positionScreen.copy(X[0]).applyMatrix4(z);for(Re=m instanceof THREE.LineSegments?2:1,J=1,K=X.length;J<K;J++)(ce=W()).positionScreen.copy(X[J]).applyMatrix4(z),(J+1)%Re>0||(pe=h[i-2],O.copy(ce.positionScreen),L.copy(pe.positionScreen),!0===U(O,L)&&(O.multiplyScalar(1/O.w),L.multiplyScalar(1/L.w),(a=F()).id=m.id,a.v1.positionScreen.copy(O),a.v2.positionScreen.copy(L),a.z=Math.max(O.z,L.z),a.renderOrder=m.renderOrder,a.material=m.material,m.material.vertexColors===THREE.VertexColors&&(a.vertexColors[0].copy(m.geometry.colors[J]),a.vertexColors[1].copy(m.geometry.colors[J-1])),w.elements.push(a)))}}else if(m instanceof THREE.Points){if(z.multiplyMatrices(b,p),v instanceof THREE.Geometry)for(J=0,K=(X=m.geometry.vertices).length;J<K;J++){Q=X[J];g.set(Q.x,Q.y,Q.z,1),g.applyMatrix4(z),N(g,m,t)}else if(v instanceof THREE.BufferGeometry){if(void 0!==(y=v.attributes).position){var we;for(R=0,S=(we=y.position.array).length;R<S;R+=3)g.set(we[R],we[R+1],we[R+2],1),g.applyMatrix4(z),N(g,m,t)}}}else m instanceof THREE.Sprite&&(g.set(p.elements[12],p.elements[13],p.elements[14],1),g.applyMatrix4(b),N(g,m,t))}return!0===d&&w.elements.sort(I),w}},$("#home_wave").length>0){var container,stats,camera,scene,renderer,particles,particle,SEPARATION=200,AMOUNTX=40,AMOUNTY=60,count=0,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2;init(),animate()}function init(){container=$("#home_wave"),(camera=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e4)).position.z=1e4,(scene=new THREE.Scene).fog=new THREE.Fog(1645341,2e3,1e4),particles=new Array;for(var e=2*Math.PI,r=new THREE.SpriteCanvasMaterial({color:16777215,program:function(r){r.beginPath(),r.arc(0,0,.5,0,e,!0),r.fill()}}),t=0,i=0;i<AMOUNTX;i++)for(var n=0;n<AMOUNTY;n++)(particle=particles[t++]=new THREE.Sprite(r)).position.x=i*SEPARATION-AMOUNTX*SEPARATION/2,particle.position.z=n*SEPARATION-AMOUNTY*SEPARATION/2,scene.add(particle);(renderer=new THREE.CanvasRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(scene.fog.color),container.append(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate),render()}function render(){camera.position.set(0,355,122);for(var e=0,r=0;r<AMOUNTX;r++)for(var t=0;t<AMOUNTY;t++)(particle=particles[e++]).position.y=50*Math.sin(.3*(r+count))+50*Math.sin(.5*(t+count)),particle.scale.x=particle.scale.y=4*(Math.sin(.3*(r+count))+1)+4*(Math.sin(.5*(t+count))+1);renderer.render(scene,camera),count+=.1}